// 質問番号
var questionNo = 0;
// 質問リスト
var questionList = getDataFromCsv();
//協調性
var kyotyoPt = 0;
//意志力
var ishiPt = 0;
//ポーカフェイス
var pokerPt = 0;

//CSVを読み込んで配列データとして返す
function getDataFromCsv() {
  var allData = [];// 読み込んだデータを1行ずつ格納する配列 
  var request = new XMLHttpRequest();
  request.open("get", "data/questionList.csv", false);
  request.send(null);

  var csvData = request.responseText;// 読み込んだCSVデータ
  var lines = csvData.split("\n");// CSVの全行を取得(改行ごとの配列データ)

  for (var i = 1; i < lines.length; i++) {
    //1行ごとに区切り文字ごとで配列データを取得(1行目はタイトルなのでスキップ)
    var wordSet = lines[i].split("|");
    //オブジェクトにデータを格納
    var wordData = {
      question: wordSet[0],
      answerList: [wordSet[1],wordSet[2],wordSet[3]],
      parameterList: {
        0:{kyotyo:1,
          ishi:1,
          poker:1
          },
        1:{kyotyo:-1,
          ishi:-1,
          poker:-1
          },
        2:{kyotyo:2,
          ishi:2,
          poker:2
        }
      }
    };
    //パラメータリストをCSVから変換
    //for (var j = 4; j < 7; j++) {
    //  var param = wordSet[j].split(",");
    //  for (var k = 0; k < param.length;k++) {
    //    var paramCore = param[k].split(":");
    //    var paramKey = paramCore[0];
    //    var paramValue = paramCore[1];
    //    wordData.parameterList[paramKey]
    //  }
    //}
    allData.push(wordData);//配列にオブジェクトを格納
  } 
  return allData;
}

// 質問と回答を表示する
function showQuestion() {
  if(questionNo < questionList.length){
    //次の問題がある場合は表示する
    document.getElementById("question").innerHTML = questionList[questionNo].question;
    answerHtml = "";//回答リスト表示用html
    var list = questionList[questionNo].answerList;//回答リスト用配列
    //回答リスト分繰り返し
    for (var i=0;i < list.length;i++) {
      var answerStr = list[i];
      //埋め込むhtml分を作成
      var valueNumber = i+1;
      answerHtml += "<input type='radio' name='radio' value='" + valueNumber +"'/>" + answerStr +"<br>";
    }
    //Htmlに回答リストを埋め込む
    document.getElementById("selectAnswerForm").innerHTML = answerHtml;
    //パラメータを表示
    document.getElementById("parameterShow").textContent = "協調性： " + kyotyoPt + " / 意志力： " + ishiPt + " / ポーカフェイス： " + pokerPt;
  } else {
    document.getElementById("question").innerHTML = "しゅーりょー";
    document.getElementById("selectAnswerForm").style.display = "none";
    document.getElementById("answerButton").style.display = "none";
  }
}

//パラメータにポイントを加減し、次の質問を表示する
function nextQuestion() {
  var selectNumber = "";//選択した番号
  for(i=0;i<answerForm.radio.length;i++) {
    if(answerForm.radio[i].checked == true) {
      selectNumber = answerForm.radio[i].value;
    }
  }
  updateParameter(selectNumber);//パラメータを更新
  questionNo++;//質問番号を次の番号へ
  showQuestion();
}

//パラメータを更新する
function updateParameter(number) {
  //選択した回答のパラメータ加減用配列を取得
  var parameterList = questionList[questionNo].parameterList;
  var parameter = parameterList[parseInt(number)-1];
  console.log(parameter);
  //パラメータを加減する
  for(var key in parameter) {
    if(JSON.stringify(key) == "kyotyo") {
      //協調性
      kyotyoPt += parseInt(parameter.key);
    } else if (JSON.stringify(key) == "ishi") {
      //意志力
      ishiPt += parseInt(parameter.key);
    } else if (JSON.stringify(key) == "poker") {
      //ポーカフェイス
      pokerPt += parseInt(parameter.key);
    } else {
      console.log("CSVのパラメータが不正");
    }
  }
}